!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["./dj_arc_column_stack_chart"]=t():e["./dj_arc_column_stack_chart"]=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function i(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=475)}({475:function(e,t){looker.plugins.visualizations.add({id:"dj_arc_column_stack_chart",label:"Demandjump column stack chart",options:{chooseTheme:{label:"Choose a theme",order:1,section:"Format",type:"string",display:"select",values:[{Horizontal:"Horizontal"},{Vertical:"Vertical"},{Custom:"Custom"}],default:"Horizontal",hidden:!1},title:{label:"Title of chart",order:4,section:"Format",type:"string",placeholder:"Enter chart title here",hidden:!1},showTitle:{label:"Show title",order:5,section:"Format",type:"boolean",default:!0,hidden:!1},yTitle:{label:"Y axis Label",order:3,section:"Format",type:"string",placeholder:"Enter y axis label",hidden:!1},xTitle:{label:"X axis label",order:2,section:"Format",type:"string",placeholder:"Enter x axis label",hidden:!1},customSpacing:{order:8,section:"Format",type:"sentence_maker",words:[{type:"separator",text:" "}],hidden:!1},customLabel:{order:9,section:"Format",type:"sentence_maker",words:[{type:"separator",text:"Custom configuration:"}],hidden:!1},stackType:{label:"100% Stack Type",order:6,section:"Format",type:"boolean",default:!1,hidden:!1},dataLabels:{label:"Enable data labels",order:10,section:"Format",type:"boolean",default:!1,hidden:!1},horizontal:{label:"Plot graph horizontally",order:11,section:"Format",type:"boolean",default:!0,hidden:!1},doNotTruncate:{label:"Don't Truncate data",order:14,section:"Format",type:"boolean",default:!1,hidden:!1}},create:function(e,t){this._custom="something",e.innerHTML='\n            <style>\n            @import url(\'https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap\');\n            * { font-family: \'Roboto\' !important; }\n            </style>\n            <div class="row">\n                <div class="col-md-6">\n                    <div class="main-card mb-3 card">\n                        <div class="card-body">\n                            <div id="chart-apex-stack"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            ',this._container=d3.select(e).append("div").attr("class","container").style("position","absolute").style("top","0").style("left","0")},updateAsync:function(e,t,i,a,n,o){d3.select("#chart-apex-stack").selectAll("*").remove();var l=e,s=!1,r=!1,d=!1;0!=a.fields.pivots.length&&(s=!0,0==a.fields.dimension_like.length?(r=!0,a.fields._dimension_like=a.fields.dimension_like,a.fields.dimension_like=a.fields.pivots):d=!0);var c=!0;!function(){for(var e=0;e<a.fields.measure_like.length;e++)if(!l[0][a.fields.measure_like[e].name].rendered.includes("%")){console.log("All percents is false",l[0][a.fields.measure_like[e].name].rendered),c=!1;break}c&&l.forEach(function(e){for(var t=0;t<a.fields.measure_like.length;t++){var i=e[a.fields.measure_like[t].name].value,n=100*i,o=n.toFixed(1);e[a.fields.measure_like[t].name].original=i,e[a.fields.measure_like[t].name].value=o}})}();var u="Horizontal";i.chooseTheme&&(u=i.chooseTheme);var m=!1,h=!1,f=!1,p=" ";i.showTitle||(i.showTitle=!1);var v=" ",k=" ",y=!1;if("Horizontal"!=u&&"Vertical"!=u||("horizontalOrVertical"!=this._custom&&(this._custom="horizontalOrVertical",this.options.customSpacing.hidden=!0,this.options.customLabel.hidden=!0,this.options.dataLabels.hidden=!0,this.options.horizontal.hidden=!0,this.options.doNotTruncate.hidden=!0,m=!0),"Horizontal"==u&&(f=!0),"Vertical"==u&&(f=!1)),"Custom"==u&&("Custom"!=this._custom&&(this._custom="Custom",this.options.customSpacing.hidden=!1,this.options.customLabel.hidden=!1,this.options.dataLabels.hidden=!1,this.options.horizontal.hidden=!1,this.options.doNotTruncate.hidden=!1,m=!0),i.dataLabels&&(h=i.dataLabels),i.horizontal&&(f=i.horizontal),i.doNotTruncate&&(y=i.doNotTruncate)),m&&this.trigger("registerOptions",this.options),""!=i.title&&(p=i.title),""!=i.yTitle&&(v=i.yTitle),""!=i.xTitle&&(k=i.xTitle),!y)for(var _=function(e){var t=!1;l.forEach(function(i){i[a.fields.measure_like[e].name].value>100&&(t=!0)}),t&&l.forEach(function(t){t[a.fields.measure_like[e].name].original=t[a.fields.measure_like[e].name].value,t[a.fields.measure_like[e].name].value=Math.trunc(t[a.fields.measure_like[e].name].value)})},b=0;b<a.fields.measure_like.length;b++)_(b);var g=[],x=[];if(s){if(r){a.pivots.forEach(function(e){var t=void 0;e.metadata[a.fields.pivots[0].name].links&&(t=e.metadata[a.fields.pivots[0].name].links),e.metadata[a.fields.pivots[0].name].rendered?null!=e.metadata[a.fields.pivots[0].name].rendered&&g.push({name:e.metadata[a.fields.pivots[0].name].rendered,links:t}):g.push({name:e.key,links:t})});a.fields.measure_like.forEach(function(e,t){for(var i=[],n=[],o=0;o<a.pivots.length;o++){var s=a.pivots[o].key,r=0;n.push(l[0][e.name][s].links),null!=l[0][e.name][s].value&&(r=l[0][e.name][s].value),i.push(r)}var d=e.label;e.label_short&&(d=e.label_short);var c={name:d,className:d.replace(/ /g,"-"),data:i,links:n};x.push(c)})}if(d){l.forEach(function(e){var t=e[a.fields.dimension_like[0].name].links;e[a.fields.dimension_like[0].name].rendered?g.push({name:e[a.fields.dimension_like[0].name].rendered,links:t}):g.push({name:e[a.fields.dimension_like[0].name].value,links:t})});for(var F=0;F<a.pivots.length;F++){var E=a.pivots[F].data[a.fields.pivots[0].name],C={name:E,className:E.replace(/ /g,"-"),data:[],links:[]};x.push(C)}l.forEach(function(e){for(var t=0;t<a.pivots.length;t++)x[t].links.push(e[a.fields.measure_like[0].name][a.pivots[t].key].links)}),l.forEach(function(e){for(var t=0;t<a.pivots.length;t++){var i=0;null!=e[a.fields.measure_like[0].name][a.pivots[t].key].value&&(i=e[a.fields.measure_like[0].name][a.pivots[t].key].value),x[t].data.push(i)}})}}else{for(b=0;b<a.fields.measure_like.length;b++){var T=a.fields.measure_like[b].label;a.fields.measure_like[b].label_short&&(T=a.fields.measure_like[b].label_short);var A={name:T,className:T.replace(/ /g,"-"),data:[],links:[]};x.push(A)}l.forEach(function(e){var t=e[a.fields.dimension_like[0].name].value,i=e[a.fields.dimension_like[0].name].links;g.push({name:t,links:i})});l.forEach(function(e,t){for(var i=0;i<a.fields.measure_like.length;i++){var n=0,o=e[a.fields.measure_like[i].name].links;null!=e[a.fields.measure_like[i].name].value&&(n=e[a.fields.measure_like[i].name].value),x[i].data.push(n),x[i].links.push(o)}})}var w=[];g.forEach(function(e){return w.push(e.name)});var z={chart:{height:window.innerHeight-45,type:"bar",stacked:"true"},colors:["#009DE9","#3EC173","#38E883","#4A4AFF","#163796","#5CF3FF","#F9BE3D","#E2FF6E","#ACEA49","#A53057","#AC7EB7","#5C3BC3","#5278CE","#A1EDFF","#05CE5A","#4A8C04","#3ABBCF","#ECE428","#E53057","#FF8571","#F9DCA0","#8FFFC7","#DFA1FF","#9C5CF7","#0D6D6D","#35A8DB","#92FFFF","#A5C0FF","#FFB0B0","#931655"],plotOptions:{bar:{horizontal:f}},dataLabels:{enabled:h,style:{fontSize:"12px",colors:["#fff"]}},stroke:{width:1,colors:["#fff"]},series:x,xaxis:{categories:w,labels:{formatter:function(e){return c&&f?e+"%":e}},title:{text:k}},yaxis:{title:{text:v},labels:{formatter:function(e){return c&&!f?e+"%":e}}},tooltip:{y:{formatter:function(e){return c?e+"%":e}}},fill:{opacity:1},legend:{position:"bottom",horizontalAlign:"center"}};1==i.stackType&&(z.chart.stackType="100%"),1==i.showTitle&&(z.title={text:p}),window.Apex={dataLabels:{enabled:!1},stroke:{width:2}};var D=new ApexCharts(document.querySelector("#chart-apex-stack"),z);document.getElementById("chart-apex-stack")&&D.render(),d3.select(".container").selectAll("*").remove();var L=document.getElementsByClassName("apexcharts-xaxis-texts-g");f&&(L=document.getElementsByClassName("apexcharts-yaxis-texts-g apexcharts-xaxis-inversed-texts-g"));var B,N=L[0].children,j=[];g.forEach(function(e,t){null==e.links&&(e.links=[]);for(var i=0;i<x.length;i++)if(void 0!==x[i].links[t])for(var a=0;a<x[i].links[t].length;a++)x[i].links[t][a].type_label||(x[i].links[t][a].type_label="Drill into ".concat(x[i].name)),e.links.push(x[i].links[t][a])});for(var H=0;H<g.length;H++){var O=(B=N[H].getBoundingClientRect()).width,S=B.height,V={index:H,id:"_".concat(N[H].id),originalId:N[H].id,coordinates:{x:B.x,y:B.y,width:O,height:S,top:B.top,left:B.left,bottom:B.bottom,right:B.right},xaxis:g[H].name,links:g[H].links,element:N[H]};j.push(V)}var M=d3.select(".container").append("div").attr("class","dimensions").selectAll(".dimension").data(j),P=M.enter().append("span");M.merge(P).attr("class","dimension").attr("id",function(e){return e.id}).style("width",function(e){return"".concat(e.coordinates.width,"px")}).style("height",function(e){return"".concat(e.coordinates.height,"px")}).style("position","absolute").style("top",function(e){return"".concat(e.coordinates.top,"px")}).style("left",function(e){return"".concat(e.coordinates.left,"px")}).style("background-color","transparent").style("opacity","0").style("z-index","4").on("click",function(e){return t=e.links,i=d3.event,void LookerCharts.Utils.openDrillMenu({links:t,event:i});var t,i}),o()}})}})});